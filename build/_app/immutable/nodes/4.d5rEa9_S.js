import{s as rt,d as h,i as M,b as m,l as $,m as ot,g as k,c as v,e as y,o as q,j as D,h as b,p as it,u as K,v as Q,n as O,r as W,f as S,t as V,a as F,q as ct}from"../chunks/zcCs4naO.js";import{S as ft,i as ut,d as P,t as T,a as E,c as U,m as L,b as H,e as B,f as X,g as Y}from"../chunks/CfCKwUYM.js";import{e as Z}from"../chunks/im_KIqQT.js";import{a as tt,t as pt,g as dt}from"../chunks/B7QDsLHE.js";import{f as j}from"../chunks/DAsLgBMN.js";import{C as A}from"../chunks/D2Ky6HrB.js";import{I as et}from"../chunks/BOJ5ACe9.js";import{B as mt}from"../chunks/Dx4fLEUM.js";function at(c,t,e){const r=c.slice();return r[9]=t[e],r}function _t(c){let t;return{c(){t=V("Применить")},l(e){t=S(e,"Применить")},m(e,r){M(e,t,r)},d(e){e&&h(t)}}}function ht(c){let t,e,r,o,n,l,i,s,a,f;function u(d){c[6](d)}let p={label:"Дата от",type:"date"};c[3]!==void 0&&(p.value=c[3]),e=new et({props:p}),K.push(()=>X(e,"value",u));function x(d){c[7](d)}let _={label:"Дата до",type:"date"};return c[4]!==void 0&&(_.value=c[4]),n=new et({props:_}),K.push(()=>X(n,"value",x)),a=new mt({props:{variant:"primary",$$slots:{default:[_t]},$$scope:{ctx:c}}}),a.$on("click",c[5]),{c(){t=b("div"),B(e.$$.fragment),o=D(),B(n.$$.fragment),i=D(),s=b("div"),B(a.$$.fragment),this.h()},l(d){t=v(d,"DIV",{class:!0});var g=y(t);H(e.$$.fragment,g),o=k(g),H(n.$$.fragment,g),i=k(g),s=v(g,"DIV",{class:!0});var I=y(s);H(a.$$.fragment,I),I.forEach(h),g.forEach(h),this.h()},h(){$(s,"class","flex items-end"),$(t,"class","grid grid-cols-1 gap-4 sm:grid-cols-3")},m(d,g){M(d,t,g),L(e,t,null),m(t,o),L(n,t,null),m(t,i),m(t,s),L(a,s,null),f=!0},p(d,g){const I={};!r&&g&8&&(r=!0,I.value=d[3],Q(()=>r=!1)),e.$set(I);const R={};!l&&g&16&&(l=!0,R.value=d[4],Q(()=>l=!1)),n.$set(R);const C={};g&4096&&(C.$$scope={dirty:g,ctx:d}),a.$set(C)},i(d){f||(E(e.$$.fragment,d),E(n.$$.fragment,d),E(a.$$.fragment,d),f=!0)},o(d){T(e.$$.fragment,d),T(n.$$.fragment,d),T(a.$$.fragment,d),f=!1},d(d){d&&h(t),P(e),P(n),P(a)}}}function gt(c){let t,e,r,o=c[0]&&st(c),n=c[1].length>0&&lt(c);return{c(){o&&o.c(),t=D(),n&&n.c(),e=W()},l(l){o&&o.l(l),t=k(l),n&&n.l(l),e=W()},m(l,i){o&&o.m(l,i),M(l,t,i),n&&n.m(l,i),M(l,e,i),r=!0},p(l,i){l[0]?o?(o.p(l,i),i&1&&E(o,1)):(o=st(l),o.c(),E(o,1),o.m(t.parentNode,t)):o&&(Y(),T(o,1,1,()=>{o=null}),U()),l[1].length>0?n?(n.p(l,i),i&2&&E(n,1)):(n=lt(l),n.c(),E(n,1),n.m(e.parentNode,e)):n&&(Y(),T(n,1,1,()=>{n=null}),U())},i(l){r||(E(o),E(n),r=!0)},o(l){T(o),T(n),r=!1},d(l){l&&(h(t),h(e)),o&&o.d(l),n&&n.d(l)}}}function $t(c){let t,e='<div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"></div>';return{c(){t=b("div"),t.innerHTML=e,this.h()},l(r){t=v(r,"DIV",{class:!0,"data-svelte-h":!0}),q(t)!=="svelte-19fpjb6"&&(t.innerHTML=e),this.h()},h(){$(t,"class","flex items-center justify-center h-64")},m(r,o){M(r,t,o)},p:O,i:O,o:O,d(r){r&&h(t)}}}function st(c){let t,e,r,o,n,l,i;return e=new A({props:{$$slots:{default:[vt]},$$scope:{ctx:c}}}),o=new A({props:{$$slots:{default:[bt]},$$scope:{ctx:c}}}),l=new A({props:{$$slots:{default:[xt]},$$scope:{ctx:c}}}),{c(){t=b("div"),B(e.$$.fragment),r=D(),B(o.$$.fragment),n=D(),B(l.$$.fragment),this.h()},l(s){t=v(s,"DIV",{class:!0});var a=y(t);H(e.$$.fragment,a),r=k(a),H(o.$$.fragment,a),n=k(a),H(l.$$.fragment,a),a.forEach(h),this.h()},h(){$(t,"class","grid grid-cols-1 gap-6 sm:grid-cols-3 mb-6")},m(s,a){M(s,t,a),L(e,t,null),m(t,r),L(o,t,null),m(t,n),L(l,t,null),i=!0},p(s,a){const f={};a&4097&&(f.$$scope={dirty:a,ctx:s}),e.$set(f);const u={};a&4097&&(u.$$scope={dirty:a,ctx:s}),o.$set(u);const p={};a&4097&&(p.$$scope={dirty:a,ctx:s}),l.$set(p)},i(s){i||(E(e.$$.fragment,s),E(o.$$.fragment,s),E(l.$$.fragment,s),i=!0)},o(s){T(e.$$.fragment,s),T(o.$$.fragment,s),T(l.$$.fragment,s),i=!1},d(s){s&&h(t),P(e),P(o),P(l)}}}function vt(c){let t,e,r="Доходы",o,n,l=j(c[0].total_income)+"",i;return{c(){t=b("div"),e=b("p"),e.textContent=r,o=D(),n=b("p"),i=V(l),this.h()},l(s){t=v(s,"DIV",{class:!0});var a=y(t);e=v(a,"P",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-1jhkg2a"&&(e.textContent=r),o=k(a),n=v(a,"P",{class:!0});var f=y(n);i=S(f,l),f.forEach(h),a.forEach(h),this.h()},h(){$(e,"class","text-sm text-gray-500 mb-2"),$(n,"class","text-2xl font-bold text-green-600"),$(t,"class","text-center")},m(s,a){M(s,t,a),m(t,e),m(t,o),m(t,n),m(n,i)},p(s,a){a&1&&l!==(l=j(s[0].total_income)+"")&&F(i,l)},d(s){s&&h(t)}}}function bt(c){let t,e,r="Расходы",o,n,l=j(c[0].total_expense)+"",i;return{c(){t=b("div"),e=b("p"),e.textContent=r,o=D(),n=b("p"),i=V(l),this.h()},l(s){t=v(s,"DIV",{class:!0});var a=y(t);e=v(a,"P",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-1nfi3y5"&&(e.textContent=r),o=k(a),n=v(a,"P",{class:!0});var f=y(n);i=S(f,l),f.forEach(h),a.forEach(h),this.h()},h(){$(e,"class","text-sm text-gray-500 mb-2"),$(n,"class","text-2xl font-bold text-red-600"),$(t,"class","text-center")},m(s,a){M(s,t,a),m(t,e),m(t,o),m(t,n),m(n,i)},p(s,a){a&1&&l!==(l=j(s[0].total_expense)+"")&&F(i,l)},d(s){s&&h(t)}}}function xt(c){let t,e,r="Баланс",o,n,l=j(c[0].balance)+"",i,s;return{c(){t=b("div"),e=b("p"),e.textContent=r,o=D(),n=b("p"),i=V(l),this.h()},l(a){t=v(a,"DIV",{class:!0});var f=y(t);e=v(f,"P",{class:!0,"data-svelte-h":!0}),q(e)!=="svelte-64eula"&&(e.textContent=r),o=k(f),n=v(f,"P",{class:!0});var u=y(n);i=S(u,l),u.forEach(h),f.forEach(h),this.h()},h(){$(e,"class","text-sm text-gray-500 mb-2"),$(n,"class",s="text-2xl font-bold "+(c[0].balance>=0?"text-green-600":"text-red-600")),$(t,"class","text-center")},m(a,f){M(a,t,f),m(t,e),m(t,o),m(t,n),m(n,i)},p(a,f){f&1&&l!==(l=j(a[0].balance)+"")&&F(i,l),f&1&&s!==(s="text-2xl font-bold "+(a[0].balance>=0?"text-green-600":"text-red-600"))&&$(n,"class",s)},d(a){a&&h(t)}}}function lt(c){let t,e;return t=new A({props:{title:"Расходы по категориям",$$slots:{default:[yt]},$$scope:{ctx:c}}}),{c(){B(t.$$.fragment)},l(r){H(t.$$.fragment,r)},m(r,o){L(t,r,o),e=!0},p(r,o){const n={};o&4099&&(n.$$scope={dirty:o,ctx:r}),t.$set(n)},i(r){e||(E(t.$$.fragment,r),e=!0)},o(r){T(t.$$.fragment,r),e=!1},d(r){P(t,r)}}}function nt(c){let t,e,r=(c[9].category_name||"Без категории")+"",o,n,l,i=j(c[9].amount)+"",s,a,f,u=c[9].count+"",p,x,_,d=(c[0]?(c[9].amount/Math.abs(c[0].total_expense)*100).toFixed(1):"0")+"",g,I,R;return{c(){t=b("tr"),e=b("td"),o=V(r),n=D(),l=b("td"),s=V(i),a=D(),f=b("td"),p=V(u),x=D(),_=b("td"),g=V(d),I=V("%"),R=D(),this.h()},l(C){t=v(C,"TR",{class:!0});var w=y(t);e=v(w,"TD",{class:!0});var z=y(e);o=S(z,r),z.forEach(h),n=k(w),l=v(w,"TD",{class:!0});var G=y(l);s=S(G,i),G.forEach(h),a=k(w),f=v(w,"TD",{class:!0});var J=y(f);p=S(J,u),J.forEach(h),x=k(w),_=v(w,"TD",{class:!0});var N=y(_);g=S(N,d),I=S(N,"%"),N.forEach(h),R=k(w),w.forEach(h),this.h()},h(){$(e,"class","px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"),$(l,"class","px-6 py-4 whitespace-nowrap text-sm text-gray-900"),$(f,"class","px-6 py-4 whitespace-nowrap text-sm text-gray-500"),$(_,"class","px-6 py-4 whitespace-nowrap text-sm text-gray-500"),$(t,"class","hover:bg-gray-50")},m(C,w){M(C,t,w),m(t,e),m(e,o),m(t,n),m(t,l),m(l,s),m(t,a),m(t,f),m(f,p),m(t,x),m(t,_),m(_,g),m(_,I),m(t,R)},p(C,w){w&2&&r!==(r=(C[9].category_name||"Без категории")+"")&&F(o,r),w&2&&i!==(i=j(C[9].amount)+"")&&F(s,i),w&2&&u!==(u=C[9].count+"")&&F(p,u),w&3&&d!==(d=(C[0]?(C[9].amount/Math.abs(C[0].total_expense)*100).toFixed(1):"0")+"")&&F(g,d)},d(C){C&&h(t)}}}function yt(c){let t,e,r,o='<tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Категория</th> <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Сумма</th> <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Количество</th> <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">%</th></tr>',n,l,i=Z(c[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=nt(at(c,i,a));return{c(){t=b("div"),e=b("table"),r=b("thead"),r.innerHTML=o,n=D(),l=b("tbody");for(let a=0;a<s.length;a+=1)s[a].c();this.h()},l(a){t=v(a,"DIV",{class:!0});var f=y(t);e=v(f,"TABLE",{class:!0});var u=y(e);r=v(u,"THEAD",{class:!0,"data-svelte-h":!0}),q(r)!=="svelte-1lq5yg1"&&(r.innerHTML=o),n=k(u),l=v(u,"TBODY",{class:!0});var p=y(l);for(let x=0;x<s.length;x+=1)s[x].l(p);p.forEach(h),u.forEach(h),f.forEach(h),this.h()},h(){$(r,"class","bg-gray-50"),$(l,"class","bg-white divide-y divide-gray-200"),$(e,"class","min-w-full divide-y divide-gray-200"),$(t,"class","overflow-x-auto")},m(a,f){M(a,t,f),m(t,e),m(e,r),m(e,n),m(e,l);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(l,null)},p(a,f){if(f&3){i=Z(a[1]);let u;for(u=0;u<i.length;u+=1){const p=at(a,i,u);s[u]?s[u].p(p,f):(s[u]=nt(p),s[u].c(),s[u].m(l,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},d(a){a&&h(t),ct(s,a)}}}function wt(c){let t,e,r,o='<h1 class="text-3xl font-bold text-gray-900">Аналитика</h1>',n,l,i,s,a,f;l=new A({props:{className:"mb-6",$$slots:{default:[ht]},$$scope:{ctx:c}}});const u=[$t,gt],p=[];function x(_,d){return _[2]?0:1}return s=x(c),a=p[s]=u[s](c),{c(){t=D(),e=b("div"),r=b("div"),r.innerHTML=o,n=D(),B(l.$$.fragment),i=D(),a.c(),this.h()},l(_){ot("svelte-xbyoe6",document.head).forEach(h),t=k(_),e=v(_,"DIV",{class:!0});var g=y(e);r=v(g,"DIV",{class:!0,"data-svelte-h":!0}),q(r)!=="svelte-1piselp"&&(r.innerHTML=o),n=k(g),H(l.$$.fragment,g),i=k(g),a.l(g),g.forEach(h),this.h()},h(){document.title="Аналитика - Budget SaaS",$(r,"class","mb-8"),$(e,"class","px-4 sm:px-6 lg:px-8")},m(_,d){M(_,t,d),M(_,e,d),m(e,r),m(e,n),L(l,e,null),m(e,i),p[s].m(e,null),f=!0},p(_,[d]){const g={};d&4120&&(g.$$scope={dirty:d,ctx:_}),l.$set(g);let I=s;s=x(_),s===I?p[s].p(_,d):(Y(),T(p[I],1,1,()=>{p[I]=null}),U(),a=p[s],a?a.p(_,d):(a=p[s]=u[s](_),a.c()),E(a,1),a.m(e,null))},i(_){f||(E(l.$$.fragment,_),E(a),f=!0)},o(_){T(l.$$.fragment,_),T(a),f=!1},d(_){_&&(h(t),h(e)),P(l),p[s].d()}}}function Et(c,t,e){let r=null,o=[],n=!1,l="",i="";it(()=>{const p=new Date,x=new Date;x.setMonth(x.getMonth()-1),e(4,i=p.toISOString().split("T")[0]),e(3,l=x.toISOString().split("T")[0]),s()});async function s(){e(2,n=!0);try{const p=new URLSearchParams;l&&p.append("from",l),i&&p.append("to",i);const[x,_]=await Promise.all([tt.get(`/analytics/summary?${p.toString()}`),tt.get(`/analytics/categories?${p.toString()}`)]);e(0,r=x.data),e(1,o=_.data||[])}catch(p){pt.error(dt(p))}finally{e(2,n=!1)}}function a(){s()}function f(p){l=p,e(3,l)}function u(p){i=p,e(4,i)}return[r,o,n,l,i,a,f,u]}class Pt extends ft{constructor(t){super(),ut(this,t,Et,wt,rt,{})}}export{Pt as component};
