import{s as Ie,n as Q,d as g,l as E,i as V,b as h,c as C,e as I,M as te,h as T,N as le,m as Fe,g as S,o as W,j as A,p as Me,O as Le,u as He,v as Ne,x as Be,K as je,a as O,f as F,t as M,r as ue,q as Se,G as oe,H as se,I as Oe}from"../chunks/zcCs4naO.js";import{S as Ae,i as Ve,d as q,t as N,a as H,c as re,m as R,b as U,e as J,f as qe,g as ae}from"../chunks/CfCKwUYM.js";import{e as X}from"../chunks/im_KIqQT.js";import{a as K,t as j,g as Y}from"../chunks/B7QDsLHE.js";import{a as ce,f as fe}from"../chunks/DAsLgBMN.js";import{B as ze}from"../chunks/Dx4fLEUM.js";import{C as Pe}from"../chunks/D2Ky6HrB.js";import{S as Re}from"../chunks/DK2GGeIu.js";function Ue(s){let e,t,l,i,r;return{c(){e=T("div"),t=le("svg"),l=le("circle"),i=le("path"),this.h()},l(u){e=C(u,"DIV",{class:!0});var b=I(e);t=te(b,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var y=I(t);l=te(y,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),I(l).forEach(g),i=te(y,"path",{class:!0,fill:!0,d:!0}),I(i).forEach(g),y.forEach(g),b.forEach(g),this.h()},h(){E(l,"class","opacity-25"),E(l,"cx","12"),E(l,"cy","12"),E(l,"r","10"),E(l,"stroke","currentColor"),E(l,"stroke-width","4"),E(i,"class","opacity-75"),E(i,"fill","currentColor"),E(i,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),E(t,"class",r="animate-spin "+s[0]+" text-primary-600"),E(t,"xmlns","http://www.w3.org/2000/svg"),E(t,"fill","none"),E(t,"viewBox","0 0 24 24"),E(e,"class","flex items-center justify-center")},m(u,b){V(u,e,b),h(e,t),h(t,l),h(t,i)},p(u,[b]){b&1&&r!==(r="animate-spin "+u[0]+" text-primary-600")&&E(t,"class",r)},i:Q,o:Q,d(u){u&&g(e)}}}function Je(s,e,t){let l,{size:i="md"}=e;return s.$$set=r=>{"size"in r&&t(1,i=r.size)},s.$$.update=()=>{s.$$.dirty&2&&t(0,l={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[i])},[l,i]}class Ge extends Ae{constructor(e){super(),Ve(this,e,Je,Ue,Ie,{size:1})}}function de(s,e,t){const l=s.slice();return l[20]=e[t],l[21]=e,l[22]=t,l}function me(s,e,t){const l=s.slice();return l[23]=e[t],l}function pe(s){let e,t,l=s[2].name+"",i;return{c(){e=T("p"),t=M("Выбран: "),i=M(l),this.h()},l(r){e=C(r,"P",{class:!0});var u=I(e);t=F(u,"Выбран: "),i=F(u,l),u.forEach(g),this.h()},h(){E(e,"class","mt-2 text-sm text-gray-600")},m(r,u){V(r,e,u),h(e,t),h(e,i)},p(r,u){u&4&&l!==(l=r[2].name+"")&&O(i,l)},d(r){r&&g(e)}}}function Ke(s){let e=s[3]?"Загрузка...":"Загрузить и обработать",t;return{c(){t=M(e)},l(l){t=F(l,e)},m(l,i){V(l,t,i)},p(l,i){i&8&&e!==(e=l[3]?"Загрузка...":"Загрузить и обработать")&&O(t,e)},d(l){l&&g(t)}}}function Ye(s){let e,t,l,i,r,u,b="Файл (CSV или PDF)",y,c,_,d,n,k,w,D;function $(a){s[12](a)}let p={label:"Счет",required:!0,options:[{value:"",label:"Выберите счет"},...s[0].map(Te)]};s[1]!==void 0&&(p.value=s[1]),t=new Re({props:p}),He.push(()=>qe(t,"value",$));let o=s[2]&&pe(s);return n=new ze({props:{variant:"primary",disabled:s[3]||!s[2]||!s[1],$$slots:{default:[Ke]},$$scope:{ctx:s}}}),n.$on("click",s[10]),{c(){e=T("div"),J(t.$$.fragment),i=A(),r=T("div"),u=T("label"),u.textContent=b,y=A(),c=T("input"),_=A(),o&&o.c(),d=A(),J(n.$$.fragment),this.h()},l(a){e=C(a,"DIV",{class:!0});var m=I(e);U(t.$$.fragment,m),i=S(m),r=C(m,"DIV",{});var v=I(r);u=C(v,"LABEL",{class:!0,"data-svelte-h":!0}),W(u)!=="svelte-4omm1s"&&(u.textContent=b),y=S(v),c=C(v,"INPUT",{type:!0,accept:!0,class:!0}),_=S(v),o&&o.l(v),v.forEach(g),d=S(m),U(n.$$.fragment,m),m.forEach(g),this.h()},h(){E(u,"class","block text-sm font-medium text-gray-700 mb-1"),E(c,"type","file"),E(c,"accept",".csv,.pdf"),E(c,"class","block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"),E(e,"class","space-y-4")},m(a,m){V(a,e,m),R(t,e,null),h(e,i),h(e,r),h(r,u),h(r,y),h(r,c),h(r,_),o&&o.m(r,null),h(e,d),R(n,e,null),k=!0,w||(D=Be(c,"change",s[9]),w=!0)},p(a,m){const v={};m&1&&(v.options=[{value:"",label:"Выберите счет"},...a[0].map(Te)]),!l&&m&2&&(l=!0,v.value=a[1],Ne(()=>l=!1)),t.$set(v),a[2]?o?o.p(a,m):(o=pe(a),o.c(),o.m(r,null)):o&&(o.d(1),o=null);const x={};m&14&&(x.disabled=a[3]||!a[2]||!a[1]),m&67108872&&(x.$$scope={dirty:m,ctx:a}),n.$set(x)},i(a){k||(H(t.$$.fragment,a),H(n.$$.fragment,a),k=!0)},o(a){N(t.$$.fragment,a),N(n.$$.fragment,a),k=!1},d(a){a&&g(e),q(t),o&&o.d(),q(n),w=!1,D()}}}function _e(s){let e,t;return e=new Pe({props:{$$slots:{default:[Ze]},$$scope:{ctx:s}}}),{c(){J(e.$$.fragment)},l(l){U(e.$$.fragment,l)},m(l,i){R(e,l,i),t=!0},p(l,i){const r={};i&67109104&&(r.$$scope={dirty:i,ctx:l}),e.$set(r)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){q(e,l)}}}function Qe(s){let e,t,l,i,r,u,b,y,c,_=s[5]==="completed"&&he(),d=(s[5]==="processing"||s[5]==="pending")&&ge(),n=s[5]==="failed"&&ve(),k=s[5]==="completed"&&be(),w=s[5]==="processing"&&ye(),D=s[5]==="pending"&&ke(),$=s[5]==="failed"&&$e();return{c(){e=T("span"),_&&_.c(),t=A(),d&&d.c(),l=A(),n&&n.c(),i=A(),r=T("span"),k&&k.c(),u=A(),w&&w.c(),b=A(),D&&D.c(),y=A(),$&&$.c(),this.h()},l(p){e=C(p,"SPAN",{class:!0});var o=I(e);_&&_.l(o),t=S(o),d&&d.l(o),l=S(o),n&&n.l(o),i=S(o),r=C(o,"SPAN",{class:!0});var a=I(r);k&&k.l(a),u=S(a),w&&w.l(a),b=S(a),D&&D.l(a),y=S(a),$&&$.l(a),a.forEach(g),o.forEach(g),this.h()},h(){E(r,"class","ml-2"),E(e,"class",c="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium "+Ce(s[5]))},m(p,o){V(p,e,o),_&&_.m(e,null),h(e,t),d&&d.m(e,null),h(e,l),n&&n.m(e,null),h(e,i),h(e,r),k&&k.m(r,null),h(r,u),w&&w.m(r,null),h(r,b),D&&D.m(r,null),h(r,y),$&&$.m(r,null)},p(p,o){p[5]==="completed"?_||(_=he(),_.c(),_.m(e,t)):_&&(_.d(1),_=null),p[5]==="processing"||p[5]==="pending"?d||(d=ge(),d.c(),d.m(e,l)):d&&(d.d(1),d=null),p[5]==="failed"?n||(n=ve(),n.c(),n.m(e,i)):n&&(n.d(1),n=null),p[5]==="completed"?k||(k=be(),k.c(),k.m(r,u)):k&&(k.d(1),k=null),p[5]==="processing"?w||(w=ye(),w.c(),w.m(r,b)):w&&(w.d(1),w=null),p[5]==="pending"?D||(D=ke(),D.c(),D.m(r,y)):D&&(D.d(1),D=null),p[5]==="failed"?$||($=$e(),$.c(),$.m(r,null)):$&&($.d(1),$=null),o&32&&c!==(c="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium "+Ce(p[5]))&&E(e,"class",c)},i:Q,o:Q,d(p){p&&g(e),_&&_.d(),d&&d.d(),n&&n.d(),k&&k.d(),w&&w.d(),D&&D.d(),$&&$.d()}}}function We(s){let e,t;return e=new Ge({props:{size:"sm"}}),{c(){J(e.$$.fragment)},l(l){U(e.$$.fragment,l)},m(l,i){R(e,l,i),t=!0},p:Q,i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){N(e.$$.fragment,l),t=!1},d(l){q(e,l)}}}function he(s){let e;return{c(){e=M("✓")},l(t){e=F(t,"✓")},m(t,l){V(t,e,l)},d(t){t&&g(e)}}}function ge(s){let e;return{c(){e=M("⏳")},l(t){e=F(t,"⏳")},m(t,l){V(t,e,l)},d(t){t&&g(e)}}}function ve(s){let e;return{c(){e=M("✕")},l(t){e=F(t,"✕")},m(t,l){V(t,e,l)},d(t){t&&g(e)}}}function be(s){let e;return{c(){e=M("Завершено")},l(t){e=F(t,"Завершено")},m(t,l){V(t,e,l)},d(t){t&&g(e)}}}function ye(s){let e;return{c(){e=M("Обработка...")},l(t){e=F(t,"Обработка...")},m(t,l){V(t,e,l)},d(t){t&&g(e)}}}function ke(s){let e;return{c(){e=M("Ожидание...")},l(t){e=F(t,"Ожидание...")},m(t,l){V(t,e,l)},d(t){t&&g(e)}}}function $e(s){let e;return{c(){e=M("Ошибка")},l(t){e=F(t,"Ошибка")},m(t,l){V(t,e,l)},d(t){t&&g(e)}}}function Ee(s){let e,t,l,i=s[6].length+"",r,u,b,y,c,_='<tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Дата</th> <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Сумма</th> <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Описание</th> <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Категория</th></tr>',d,n,k,w,D,$=X(s[6]),p=[];for(let o=0;o<$.length;o+=1)p[o]=De(de(s,$,o));return w=new ze({props:{variant:"primary",$$slots:{default:[Xe]},$$scope:{ctx:s}}}),w.$on("click",s[11]),{c(){e=T("div"),t=T("p"),l=M("Найдено транзакций: "),r=M(i),u=A(),b=T("div"),y=T("table"),c=T("thead"),c.innerHTML=_,d=A(),n=T("tbody");for(let o=0;o<p.length;o+=1)p[o].c();k=A(),J(w.$$.fragment),this.h()},l(o){e=C(o,"DIV",{class:!0});var a=I(e);t=C(a,"P",{class:!0});var m=I(t);l=F(m,"Найдено транзакций: "),r=F(m,i),m.forEach(g),u=S(a),b=C(a,"DIV",{class:!0});var v=I(b);y=C(v,"TABLE",{class:!0});var x=I(y);c=C(x,"THEAD",{class:!0,"data-svelte-h":!0}),W(c)!=="svelte-udqxk2"&&(c.innerHTML=_),d=S(x),n=C(x,"TBODY",{class:!0});var f=I(n);for(let B=0;B<p.length;B+=1)p[B].l(f);f.forEach(g),x.forEach(g),v.forEach(g),a.forEach(g),k=S(o),U(w.$$.fragment,o),this.h()},h(){E(t,"class","text-sm text-gray-600 mb-2"),E(c,"class","bg-gray-50 sticky top-0"),E(n,"class","bg-white divide-y divide-gray-200"),E(y,"class","min-w-full divide-y divide-gray-200"),E(b,"class","overflow-x-auto max-h-96 overflow-y-auto"),E(e,"class","mb-4")},m(o,a){V(o,e,a),h(e,t),h(t,l),h(t,r),h(e,u),h(e,b),h(b,y),h(y,c),h(y,d),h(y,n);for(let m=0;m<p.length;m+=1)p[m]&&p[m].m(n,null);V(o,k,a),R(w,o,a),D=!0},p(o,a){if((!D||a&64)&&i!==(i=o[6].length+"")&&O(r,i),a&320){$=X(o[6]);let v;for(v=0;v<$.length;v+=1){const x=de(o,$,v);p[v]?p[v].p(x,a):(p[v]=De(x),p[v].c(),p[v].m(n,null))}for(;v<p.length;v+=1)p[v].d(1);p.length=$.length}const m={};a&67108864&&(m.$$scope={dirty:a,ctx:o}),w.$set(m)},i(o){D||(H(w.$$.fragment,o),D=!0)},o(o){N(w.$$.fragment,o),D=!1},d(o){o&&(g(e),g(k)),Se(p,o),q(w,o)}}}function we(s){let e,t=s[23].name+"",l,i;return{c(){e=T("option"),l=M(t),this.h()},l(r){e=C(r,"OPTION",{});var u=I(e);l=F(u,t),u.forEach(g),this.h()},h(){e.__value=i=s[23].id,se(e,e.__value)},m(r,u){V(r,e,u),h(e,l)},p(r,u){u&64&&t!==(t=r[23].name+"")&&O(l,t),u&320&&i!==(i=r[23].id)&&(e.__value=i,se(e,e.__value))},d(r){r&&g(e)}}}function De(s){let e,t,l=ce(s[20].date)+"",i,r,u,b=fe(s[20].amount,s[20].currency||"RUB")+"",y,c,_,d,n=(s[20].description||"-")+"",k,w,D,$,p,o="Без категории",a,m,v,x=X(s[8](s[20].amount||0)),f=[];for(let L=0;L<x.length;L+=1)f[L]=we(me(s,x,L));function B(){s[13].call($,s[21],s[22])}return{c(){e=T("tr"),t=T("td"),i=M(l),r=A(),u=T("td"),y=M(b),_=A(),d=T("td"),k=M(n),w=A(),D=T("td"),$=T("select"),p=T("option"),p.textContent=o;for(let L=0;L<f.length;L+=1)f[L].c();a=A(),this.h()},l(L){e=C(L,"TR",{class:!0});var P=I(e);t=C(P,"TD",{class:!0});var z=I(t);i=F(z,l),z.forEach(g),r=S(P),u=C(P,"TD",{class:!0});var G=I(u);y=F(G,b),G.forEach(g),_=S(P),d=C(P,"TD",{class:!0});var ne=I(d);k=F(ne,n),ne.forEach(g),w=S(P),D=C(P,"TD",{class:!0});var ie=I(D);$=C(ie,"SELECT",{class:!0});var Z=I($);p=C(Z,"OPTION",{"data-svelte-h":!0}),W(p)!=="svelte-1kmrtl"&&(p.textContent=o);for(let ee=0;ee<f.length;ee+=1)f[ee].l(Z);Z.forEach(g),ie.forEach(g),a=S(P),P.forEach(g),this.h()},h(){E(t,"class","px-4 py-2 whitespace-nowrap text-sm text-gray-900"),E(u,"class",c="px-4 py-2 whitespace-nowrap text-sm font-medium "+(s[20].amount>=0?"text-green-600":"text-red-600")),E(d,"class","px-4 py-2 text-sm text-gray-900"),p.__value="",se(p,p.__value),E($,"class","block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 text-sm"),s[20].category_id===void 0&&Oe(B),E(D,"class","px-4 py-2 text-sm text-gray-900"),E(e,"class","hover:bg-gray-50")},m(L,P){V(L,e,P),h(e,t),h(t,i),h(e,r),h(e,u),h(u,y),h(e,_),h(e,d),h(d,k),h(e,w),h(e,D),h(D,$),h($,p);for(let z=0;z<f.length;z+=1)f[z]&&f[z].m($,null);oe($,s[20].category_id,!0),h(e,a),m||(v=Be($,"change",B),m=!0)},p(L,P){if(s=L,P&64&&l!==(l=ce(s[20].date)+"")&&O(i,l),P&64&&b!==(b=fe(s[20].amount,s[20].currency||"RUB")+"")&&O(y,b),P&320&&c!==(c="px-4 py-2 whitespace-nowrap text-sm font-medium "+(s[20].amount>=0?"text-green-600":"text-red-600"))&&E(u,"class",c),P&64&&n!==(n=(s[20].description||"-")+"")&&O(k,n),P&320){x=X(s[8](s[20].amount||0));let z;for(z=0;z<x.length;z+=1){const G=me(s,x,z);f[z]?f[z].p(G,P):(f[z]=we(G),f[z].c(),f[z].m($,null))}for(;z<f.length;z+=1)f[z].d(1);f.length=x.length}P&320&&oe($,s[20].category_id)},d(L){L&&g(e),Se(f,L),m=!1,v()}}}function Xe(s){let e;return{c(){e=M("Сохранить транзакции")},l(t){e=F(t,"Сохранить транзакции")},m(t,l){V(t,e,l)},d(t){t&&g(e)}}}function Ze(s){let e,t,l,i,r="Статус обработки",u,b,y,c,_,d,n,k,w,D;const $=[We,Qe],p=[];function o(m,v){return m[7]?0:m[5]?1:-1}~(d=o(s))&&(n=p[d]=$[d](s));let a=s[5]==="completed"&&s[6].length>0&&Ee(s);return{c(){e=T("div"),t=T("div"),l=T("div"),i=T("h3"),i.textContent=r,u=A(),b=T("p"),y=M("Job ID: "),c=M(s[4]),_=A(),n&&n.c(),k=A(),a&&a.c(),w=ue(),this.h()},l(m){e=C(m,"DIV",{class:!0});var v=I(e);t=C(v,"DIV",{class:!0});var x=I(t);l=C(x,"DIV",{});var f=I(l);i=C(f,"H3",{class:!0,"data-svelte-h":!0}),W(i)!=="svelte-e92z6d"&&(i.textContent=r),u=S(f),b=C(f,"P",{class:!0});var B=I(b);y=F(B,"Job ID: "),c=F(B,s[4]),B.forEach(g),f.forEach(g),_=S(x),n&&n.l(x),x.forEach(g),v.forEach(g),k=S(m),a&&a.l(m),w=ue(),this.h()},h(){E(i,"class","text-lg font-semibold text-gray-900"),E(b,"class","text-sm text-gray-500"),E(t,"class","flex items-center justify-between"),E(e,"class","mb-4")},m(m,v){V(m,e,v),h(e,t),h(t,l),h(l,i),h(l,u),h(l,b),h(b,y),h(b,c),h(t,_),~d&&p[d].m(t,null),V(m,k,v),a&&a.m(m,v),V(m,w,v),D=!0},p(m,v){(!D||v&16)&&O(c,m[4]);let x=d;d=o(m),d===x?~d&&p[d].p(m,v):(n&&(ae(),N(p[x],1,1,()=>{p[x]=null}),re()),~d?(n=p[d],n?n.p(m,v):(n=p[d]=$[d](m),n.c()),H(n,1),n.m(t,null)):n=null),m[5]==="completed"&&m[6].length>0?a?(a.p(m,v),v&96&&H(a,1)):(a=Ee(m),a.c(),H(a,1),a.m(w.parentNode,w)):a&&(ae(),N(a,1,1,()=>{a=null}),re())},i(m){D||(H(n),H(a),D=!0)},o(m){N(n),N(a),D=!1},d(m){m&&(g(e),g(k),g(w)),~d&&p[d].d(),a&&a.d(m)}}}function et(s){let e,t,l,i='<h1 class="text-3xl font-bold text-gray-900">Парсер выписок</h1> <p class="mt-2 text-sm text-gray-600">Загрузите CSV или PDF файл для автоматического извлечения транзакций</p>',r,u,b,y;u=new Pe({props:{className:"mb-6",$$slots:{default:[Ye]},$$scope:{ctx:s}}});let c=s[4]&&_e(s);return{c(){e=A(),t=T("div"),l=T("div"),l.innerHTML=i,r=A(),J(u.$$.fragment),b=A(),c&&c.c(),this.h()},l(_){Fe("svelte-123nujp",document.head).forEach(g),e=S(_),t=C(_,"DIV",{class:!0});var n=I(t);l=C(n,"DIV",{class:!0,"data-svelte-h":!0}),W(l)!=="svelte-1qzorr3"&&(l.innerHTML=i),r=S(n),U(u.$$.fragment,n),b=S(n),c&&c.l(n),n.forEach(g),this.h()},h(){document.title="Парсер - Budget SaaS",E(l,"class","mb-8"),E(t,"class","px-4 sm:px-6 lg:px-8")},m(_,d){V(_,e,d),V(_,t,d),h(t,l),h(t,r),R(u,t,null),h(t,b),c&&c.m(t,null),y=!0},p(_,[d]){const n={};d&67108879&&(n.$$scope={dirty:d,ctx:_}),u.$set(n),_[4]?c?(c.p(_,d),d&16&&H(c,1)):(c=_e(_),c.c(),H(c,1),c.m(t,null)):c&&(ae(),N(c,1,1,()=>{c=null}),re())},i(_){y||(H(u.$$.fragment,_),H(c),y=!0)},o(_){N(u.$$.fragment,_),N(c),y=!1},d(_){_&&(g(e),g(t)),q(u),c&&c.d()}}}let xe=1e4;function Ce(s){switch(s){case"completed":return"bg-green-100 text-green-800";case"processing":case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}const Te=s=>({value:s.id,label:s.account_name});function tt(s,e,t){let l=[],i=[],r="",u=null,b=!1,y=null,c=null,_=[],d=!1,n=2e3,k=null;Me(()=>{w(),D()}),Le(()=>{k&&(clearTimeout(k),k=null)});async function w(){try{const f=await K.get("/accounts");t(0,l=f.data||[])}catch(f){j.error(Y(f))}}async function D(){try{i=(await K.get("/categories")).data||[]}catch(f){j.error(Y(f))}}function $(f){return f>=0?i.filter(B=>B.type==="income"):i.filter(B=>B.type==="expense")}function p(f){const B=f.target;B.files&&B.files[0]&&t(2,u=B.files[0])}async function o(){if(!u||!r){j.error("Выберите файл и счет");return}t(3,b=!0);try{const f=new FormData;f.append("file",u),f.append("account_id",r);const B=await K.post("/parser/upload",f,{headers:{"Content-Type":"multipart/form-data"}});t(4,y=B.data.job_id),t(5,c=B.data.status),n=2e3,j.success("Файл загружен, начинается обработка..."),a()}catch(f){j.error(Y(f))}finally{t(3,b=!1)}}async function a(){if(y){t(7,d=!0);try{const f=await K.get(`/parser/result/${y}`);t(5,c=f.data.status),t(6,_=f.data.transactions||[]),c==="processing"||c==="pending"?(n=Math.min(n*1.5,xe),k=setTimeout(()=>a(),n)):c==="failed"?(j.error("Ошибка обработки файла: "+(f.data.error||"Неизвестная ошибка")),k=null):c==="completed"&&(k=null,n=2e3)}catch(f){j.error(Y(f)),(c==="processing"||c==="pending")&&(n=Math.min(n*1.5,xe),k=setTimeout(()=>a(),n))}finally{t(7,d=!1)}}}async function m(){if(y)try{await K.post(`/parser/commit/${y}`,{transactions:_.map(f=>({amount:f.amount,description:f.description||"",date:f.date,time:f.time||null,currency:f.currency||"RUB",external_id:f.external_id||null,category_id:f.category_id||null}))}),j.success("Транзакции успешно добавлены"),t(4,y=null),t(5,c=null),t(6,_=[]),t(2,u=null),t(1,r="")}catch(f){j.error(Y(f))}}function v(f){r=f,t(1,r)}function x(f,B){f[B].category_id=je(this),t(6,_),t(8,$)}return[l,r,u,b,y,c,_,d,$,p,o,m,v,x]}class ct extends Ae{constructor(e){super(),Ve(this,e,tt,et,Ie,{})}}export{ct as component};
